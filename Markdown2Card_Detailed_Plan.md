# Markdown2Card 产品需求文档 (PRD) & 技术方案

## 1. 产品概述
Markdown2Card 是一款纯前端的工具，旨在将 Markdown 文本转换成精美的、适合社交媒体分享的卡片。用户可以通过简单的输入和配置，生成多张风格统一的图片。

## 2. 核心功能点 (Refined)

### 2.1 编辑与预览
- **实时编辑**：左侧/上方为 Markdown 输入区，支持标准 GFM 语法。
- **实时预览**：右侧/下方实时渲染生成的卡片效果。
- **语法高亮**：代码块支持 Prism.js 语法高亮。

### 2.2 卡片定制化
- **主题风格**：预设多种主题（如：极简白、深邃黑、玻璃拟态、复古纸张等）。**不同主题拥有独立的默认字体大小和行高配置**。
- **背景设置**：
    - 支持纯色背景。
    - 支持多种预设的渐变色（Linear Gradients）。
    - 支持自定义上传背景图片。
- **布局控制**：
    - **比例选择**：1:1 (Instagram), 4:3, 3:4, 16:9, 9:16 (Story)。
    - **容量限制**：不同比例的卡片具有固定的文本容纳上限（基于行数和字符数）。
    - **内边距 (Padding)**：可调节文字与边框的距离。
    - **圆角 (Border Radius)**：可调节卡片圆角大小。
    - **阴影 (Shadow)**：可开启/关闭卡片投影。

### 2.3 长文自动切割
- **自动切割逻辑**：系统根据选定的**卡片比例**和**主题字体大小**，自动计算单张卡片可容纳的最大行数。
    - **1:1 比例**：约 10 行 × 20 个汉字宽度。
    - **3:4 比例**：约 15 行 × 20 个汉字宽度。
    - **9:16 比例**：约 28 行 × 20 个汉字宽度。
- **切割执行**：当 Markdown 渲染后的内容超过当前比例的行数限制时，自动将剩余内容切分至下一张卡片。
- **统一风格**：所有切割出的卡片共享相同的主题、背景和比例设置。

### 2.4 预览画册 (Gallery)
- **瀑布流/网格展示**：在页面下方展示所有生成的卡片缩略图。
- **单张操作**：点击缩略图可放大查看或单独下载。

### 2.5 导出与下载
- **单张下载**：点击卡片上的下载按钮，导出为 PNG/JPG。
- **批量下载**：一键将所有生成的卡片打包为 `cards.zip`。

---

## 3. UI/UX 设计方案

### 3.1 布局结构
- **Header**：标题、GitHub 链接、全局操作按钮（导出全部）。
- **Main Content**：
    - **左侧面板 (Settings & Editor)**：
        - 配置项：比例、主题、背景、字体大小等。
        - 编辑器：支持行号和基础快捷键。
    - **右侧面板 (Live Preview)**：展示当前正在编辑的卡片。
- **Footer/Gallery Section**：展示所有生成的卡片序列。

### 3.2 交互体验
- 使用 Tailwind CSS 实现响应式布局。
- 所有的配置更改（如切换背景色）应有平滑的过渡效果。
- 导出时显示进度条或 Loading 状态。

---

## 4. 技术实现方案

### 4.1 技术栈选型
- **框架**：Vue 3 (通过 CDN 引入，无需构建步骤，适合单 HTML 页面)。
- **样式**：Tailwind CSS (Play CDN)。
- **Markdown 解析**：`marked.js`。
- **代码高亮**：`Prism.js`。
- **图片生成**：`html-to-image` (相比 html2canvas，对 CSS3 属性支持更好，生成的图片更清晰)。
- **压缩打包**：`JSZip` + `FileSaver.js`。
- **图标**：`Lucide Icons`。

### 4.2 核心逻辑实现思路

#### A. 基于容量的自动切割算法
1. **建立容量矩阵**：定义一个配置对象，存储不同比例（1:1, 3:4, 9:16等）在不同主题下的 `maxLines` 和 `charsPerLine`。
2. **文本预处理**：将 Markdown 解析为 HTML 节点流。
3. **行数估算逻辑**：
    - 遍历 HTML 节点，根据节点的类型（标题、段落、列表项）计算其占用的“标准行”数。
    - 例如：一个 `h1` 可能占用 2 行高度，一个普通段落根据字符数折算行数（`Math.ceil(总字符数 / charsPerLine)`）。
4. **分页决策**：
    - 维护一个当前卡片的 `currentLines` 计数器。
    - 当新节点加入会导致 `currentLines > maxLines` 时，开启新卡片。
5. **主题关联**：切换主题时，动态更新 `maxLines` 阈值（因为不同主题的字体大小和行高不同），并重新触发切割逻辑。

#### B. 图片生成流程
1. 遍历预览区域的所有卡片 DOM 节点。
2. 调用 `htmlToImage.toPng(node)` 获取 DataURL。
3. 使用 `JSZip` 将 DataURL 转换为 Blob 并添加到压缩包。
4. 触发浏览器下载。

#### C. 响应式预览
- 使用 CSS `aspect-ratio` 属性来锁定卡片比例。
- 使用 `transform: scale()` 动态缩放预览区，确保在不同屏幕尺寸下都能完整看到卡片。

---

## 5. 决策点 (待确认)
1. **是否需要支持数学公式 (LaTeX)**？（建议：初期不加，后期扩展）
2. **是否需要支持水印自定义**？（建议：增加一个简单的文本水印配置）
3. **字体支持**：是否需要引入 Google Fonts？（建议：引入 2-3 款精选字体，如 Inter, JetBrains Mono）
