<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êûó‰π¶Âç°Áâá - Ëá™Â™í‰ΩìÂçö‰∏ªÂøÖÂ§áÁöÑÁü•ËØÜÂàÜ‰∫´Â∑•ÂÖ∑</title>
    <meta name="description" content="Êûó‰π¶Âç°ÁâáÊòØ‰∏ÄÊ¨æ‰∏ì‰∏∫Ëá™Â™í‰ΩìÂçö‰∏ªËÆæËÆ°ÁöÑ Markdown ËΩ¨Âç°ÁâáÂ∑•ÂÖ∑„ÄÇÊîØÊåÅÊô∫ËÉΩÂàÜÈ°µ„ÄÅÂ§öÁßçÁ≤æÁæé‰∏ªÈ¢ò„ÄÅËá™ÂÆö‰πâÊ∞¥Âç∞ÔºåÂ∏ÆÂä©Âçö‰∏ªÂø´ÈÄüÁîüÊàêÈÄÇÂêàÂ∞èÁ∫¢‰π¶„ÄÅÁü•‰πé„ÄÅÂæÆÂçöÁ≠âÂπ≥Âè∞ÁöÑÁü•ËØÜÂàÜ‰∫´ÂõæÁâá„ÄÇ">
    <meta name="keywords" content="Êûó‰π¶Âç°Áâá,Ëá™Â™í‰ΩìÂ∑•ÂÖ∑,Áü•ËØÜÂàÜ‰∫´,MarkdownËΩ¨ÂõæÁâá,Â∞èÁ∫¢‰π¶ÈÖçÂõæ,Âπ≤Ë¥ßÂàÜ‰∫´,Âçö‰∏ªÊéíÁâàÂ∑•ÂÖ∑">
    <meta name="author" content="Êûó‰π¶">
    <!-- Êú¨Âú∞‰æùËµñÊñá‰ª∂ -->
    <script src="./js/tailwind.js"></script>
    <script src="./js/vue.global.prod.min.js"></script>
    <script src="./js/marked.min.js"></script>
    <script src="./js/html-to-image.min.js"></script>
    <script src="./js/jszip.min.js"></script>
    <script src="./js/FileSaver.min.js"></script>
    <script src="./js/lucide.min.js"></script>
    
    <style>
        @import url('https://fonts.loli.net/css2?family=Inter:wght@400;600&family=JetBrains+Mono&family=Noto+Sans+SC:wght@400;500;700;900&display=swap');
        
        /* MapleMono NF CN Â≠ó‰ΩìÂÆö‰πâ */
        @font-face {
            font-family: 'MapleMono-NF-CN-Light';
            src: url('./assets/font/MapleMono-TTF/MapleMono-NF-CN-Light.ttf') format('truetype');
            font-weight: 300;
            font-style: normal;
        }
        @font-face {
            font-family: 'MapleMono-NF-CN-Regular';
            src: url('./assets/font/MapleMono-TTF/MapleMono-NF-CN-Regular.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
        }
        @font-face {
            font-family: 'MapleMono-NF-CN-Medium';
            src: url('./assets/font/MapleMono-TTF/MapleMono-NF-CN-Medium.ttf') format('truetype');
            font-weight: 500;
            font-style: normal;
        }
        
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            background-color: #121212;
            color: #e2e8f0;
            overflow: hidden;
        }

        .markdown-body h1 { font-size: 1.8em; font-weight: bold; margin-bottom: 0.6em; font-family: inherit; }
        .markdown-body h2 { font-size: 1.4em; font-weight: bold; margin-bottom: 0.5em; font-family: inherit; }
        .markdown-body p { margin-bottom: 1em; line-height: 1.7; font-family: inherit; }
        .markdown-body ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; font-family: inherit; }
        .markdown-body ol { list-style-type: decimal; padding-left: 1.5em; margin-bottom: 1em; font-family: inherit; }
        .markdown-body ul ul, .markdown-body ul ol, .markdown-body ol ul, .markdown-body ol ol { margin-top: 0.5em; margin-bottom: 0.5em; }
        .markdown-body li { font-family: inherit; }
        .markdown-body strong, .markdown-body b { font-weight: bold; font-family: inherit; }
        .markdown-body em, .markdown-body i { font-style: italic; font-family: inherit; }
        .markdown-body code { background: rgba(0,0,0,0.1); padding: 0.2em 0.4em; border-radius: 4px; font-family: 'JetBrains Mono', monospace; }

        .markdown-body table { width: 100%; border-collapse: collapse; margin: 1em 0; font-family: inherit; }
        .markdown-body th, .markdown-body td { border: 1px solid rgba(0,0,0,0.7); padding: 0.45em 0.7em; vertical-align: top; }
        .markdown-body thead th { background: rgba(0,0,0,0.06); font-weight: 600; }
        .markdown-body tbody tr:nth-child(even) td { background: rgba(0,0,0,0.03); }

        /* Modern(Áü•ËØÜÂ∫ìÊéíÁâà2) theme */
        .modern-knowledge {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .modern-knowledge__image {
            width: 100%;
            aspect-ratio: 4 / 3;
            overflow: hidden;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            position: relative;
        }
        .modern-knowledge__placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, rgba(0,0,0,0.05) 0%, rgba(0,0,0,0) 100%);
            color: rgba(0, 0, 0, 0.2);
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            padding: 40px;
            white-space: pre-line;
        }
        .modern-knowledge__body {
            flex: 1;
            position: relative;
            padding: 40px 35px 35px;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        .modern-knowledge__title {
            font-size: 36px;
            font-weight: 900;
            line-height: 1.3;
            color: #1a1a1a;
            margin-bottom: 20px;
            letter-spacing: 0.5px;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 3;
            line-clamp: 3;
            overflow: hidden;
        }
        .modern-knowledge__desc {
            font-size: 15px;
            font-weight: 400;
            line-height: 1.7;
            color: #2c2c2c;
            letter-spacing: 0.3px;
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }
        .modern-knowledge__desc p { margin-bottom: 25px; }
        .modern-knowledge__desc p:last-child { margin-bottom: 0; }
        .modern-knowledge__divider {
            width: 100%;
            height: 1px;
            background: rgba(0, 0, 0, 0.15);
            margin: 20px 0;
        }
        .modern-knowledge__signature {
            font-size: 12px;
            color: #3a3a3a;
            text-align: center;
            letter-spacing: 1px;
        }
        .modern-knowledge__footer {
            margin-top: auto;
            flex-shrink: 0;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .sidebar-bg { background-color: #1e1e1e; }
        .main-bg { background-color: #0f0f0f; }
        .border-color { border-color: #2d2d2d; }
        
        .tab-active { color: #6366f1; border-bottom: 2px solid #6366f1; }
        
        .card-fixed-container {
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body>
    <div id="app" class="h-screen flex flex-col">
        <header class="h-14 sidebar-bg border-b border-color flex items-center justify-between px-4 shrink-0">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-indigo-600 rounded flex items-center justify-center">
                    <i data-lucide="layers" class="w-5 h-5 text-white"></i>
                </div>
                <span class="font-bold text-lg tracking-tight">Êûó‰π¶Âç°Áâá</span>
            </div>
            <div class="flex items-center gap-2">
                <a href="/index_zh.html" class="flex items-center gap-1 px-3 py-1.5 text-xs text-slate-400 hover:text-white hover:bg-white/5 rounded-md transition mr-2">
                    <i data-lucide="scissors" class="w-3.5 h-3.5"></i>
                    ÂÜÖÂÆπÊãÜÂàÜ
                </a>
                <div class="flex bg-black/30 rounded-lg p-1">
                    <button class="px-3 py-1 text-xs hover:bg-white/10 rounded transition text-indigo-400 font-medium">Âç°ÁâáÁîüÊàê</button>
                </div>
                <button @click="exportAllAsZip" :disabled="isExporting" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-1.5 rounded-md text-sm font-medium flex items-center gap-2 transition ml-2">
                    <i data-lucide="download" class="w-4 h-4"></i>
                    {{ isExporting ? 'ÂØºÂá∫‰∏≠...' : 'ÂØºÂá∫' }}
                </button>
            </div>
        </header>

        <div class="flex-1 flex overflow-hidden">
            <aside class="w-80 sidebar-bg border-r border-color flex flex-col shrink-0">
                <div class="flex border-b border-color">
                    <button @click="leftTab = 'content'" :class="['flex-1 py-3 text-sm font-medium transition', leftTab === 'content' ? 'tab-active' : 'text-slate-400 hover:text-slate-200']">ÂÜÖÂÆπ</button>
                    <button @click="leftTab = 'themes'" :class="['flex-1 py-3 text-sm font-medium transition', leftTab === 'themes' ? 'tab-active' : 'text-slate-400 hover:text-slate-200']">Ê®°Êùø</button>
                </div>
                
                <div class="flex-1 overflow-y-auto p-4 no-scrollbar">
                    <!-- Content Tab -->
                    <div v-if="leftTab === 'content'" class="h-full flex flex-col gap-0">
                        <!-- Title Input -->
                        <div class="pb-3">
                            <label class="text-[10px] text-slate-500 uppercase font-bold block mb-2">Ê†áÈ¢ò (ÂøÖÂ°´)</label>
                            <input v-model="config.title" type="text" class="w-full bg-black/20 border border-color rounded-lg px-3 py-2 text-sm font-bold text-white focus:ring-1 focus:ring-indigo-500 outline-none" placeholder="ËæìÂÖ•ÊñáÁ´†Ê†áÈ¢ò...">
                        </div>

                        <!-- Cover Image (Modern theme only, page 1) -->
                        <div v-if="config.theme === 'modern'" class="pb-3">
                            <label class="text-[10px] text-slate-500 uppercase font-bold block mb-2">Â∞ÅÈù¢ÂõæÁâá (‰ªÖÁ¨¨‰∏ÄÈ°µ, 4:3)</label>
                            <div class="flex items-center gap-3">
                                <label class="cursor-pointer shrink-0">
                                    <input type="file" accept="image/*" @change="handleCoverUpload" class="hidden">
                                    <div class="w-32 aspect-[4/3] rounded-lg border border-color bg-black/20 overflow-hidden flex items-center justify-center hover:border-indigo-500 transition">
                                        <img v-if="config.coverImage" :key="config.coverImage" :src="config.coverImage" class="w-full h-full object-cover" />
                                        <span v-else class="text-xs text-slate-400 text-center px-2">ÁÇπÂáª‰∏ä‰º†
Â∞ÅÈù¢Âõæ</span>
                                    </div>
                                </label>
                                <button v-if="config.coverImage" @click="clearCoverImage" class="px-3 py-2 text-xs rounded border border-color text-slate-300 hover:border-indigo-500 hover:text-white transition">ÁßªÈô§Â∞ÅÈù¢</button>
                                <span class="text-[10px] text-slate-500">Âª∫ËÆÆÊØî‰æã 4:3</span>
                            </div>
                        </div>

                        <!-- Markdown Input -->
                        <div class="flex-1 flex flex-col min-h-[200px] pb-3">
                            <label class="text-[10px] text-slate-500 uppercase font-bold block mb-2">Ê≠£ÊñáÂÜÖÂÆπ</label>
                            <textarea 
                                v-model="markdownInput"
                                class="flex-1 w-full bg-black/20 border border-color rounded-lg p-4 text-sm font-mono focus:ring-1 focus:ring-indigo-500 outline-none resize-none text-slate-300"
                                placeholder="Âú®Ê≠§ËæìÂÖ• Markdown..."
                            ></textarea>
                        </div>

                        <!-- Author Badge -->
                        <div v-if="currentThemeConfig.author.editable" class="py-3">
                            <div class="flex justify-between items-center mb-3">
                                <label class="text-[10px] text-slate-500 uppercase font-bold">‰ΩúËÄÖ‰ø°ÊÅØ</label>
                                <div class="relative inline-block w-8 h-4 align-middle select-none transition duration-200 ease-in">
                                    <input type="checkbox" v-model="config.showAuthor" class="toggle-checkbox absolute block w-4 h-4 rounded-full bg-white border-4 appearance-none cursor-pointer transition-transform duration-200 ease-in-out" :class="{ 'translate-x-4 border-indigo-600': config.showAuthor, 'border-slate-400': !config.showAuthor }"/>
                                    <label class="toggle-label block overflow-hidden h-4 rounded-full bg-slate-700 cursor-pointer"></label>
                                </div>
                            </div>
                            <div v-if="config.showAuthor" class="space-y-3">
                                <!-- Avatar and Input Area -->
                                <div class="flex gap-3 items-start">
                                    <!-- Avatar Circle -->
                                    <label class="cursor-pointer shrink-0">
                                        <input type="file" accept="image/*" @change="handleAvatarUpload" class="hidden">
                                        <div class="w-16 h-16 rounded-full border-2 border-color bg-black/40 flex items-center justify-center overflow-hidden hover:border-indigo-500 transition">
                                            <img v-if="config.authorAvatar" :key="config.authorAvatar" :src="config.authorAvatar" class="w-full h-full object-cover" />
                                            <svg v-else-if="config.socialIcon" viewBox="0 0 24 24" class="w-10 h-10" :fill="socialIcons.find(s => s.icon === config.socialIcon)?.color">
                                                <path :d="socialIcons.find(s => s.icon === config.socialIcon)?.path"/>
                                            </svg>
                                            <span v-else class="text-lg">üë§</span>
                                        </div>
                                    </label>
                                    
                                    <!-- Input Fields -->
                                    <div class="flex-1 space-y-2">
                                        <input v-model="config.authorNickname" type="text" class="w-full bg-black/40 border border-color rounded px-3 py-2 text-xs text-slate-300 outline-none focus:border-indigo-500" placeholder="Áî®Êà∑ÊòµÁß∞">
                                        <input v-model="config.authorUsername" type="text" class="w-full bg-black/40 border border-color rounded px-3 py-2 text-xs text-slate-300 outline-none focus:border-indigo-500" placeholder="Áî®Êà∑Âêç">
                                    </div>
                                </div>
                                
                                <!-- Social Media Icons -->
                                <div class="grid grid-cols-6 gap-2">
                                    <button v-for="social in socialIcons" :key="social.icon"
                                        @click="selectSocialIcon(social.icon)"
                                        :class="['p-2 rounded border transition-all', config.socialIcon === social.icon ? 'border-indigo-500 bg-indigo-500/20' : 'border-color bg-black/40 hover:border-indigo-400']"
                                        :title="social.name">
                                        <svg viewBox="0 0 24 24" class="w-6 h-6" :fill="social.color">
                                            <path :d="social.path"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Time Label -->
                        <div v-if="currentThemeConfig.time.editable" class="py-3">
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-[10px] text-slate-500 uppercase font-bold">Êó∂Èó¥Ê†áÁ≠æ</label>
                                <div class="relative inline-block w-8 h-4 align-middle select-none transition duration-200 ease-in">
                                    <input type="checkbox" v-model="config.showTime" class="toggle-checkbox absolute block w-4 h-4 rounded-full bg-white border-4 appearance-none cursor-pointer transition-transform duration-200 ease-in-out" :class="{ 'translate-x-4 border-indigo-600': config.showTime, 'border-slate-400': !config.showTime }"/>
                                    <label class="toggle-label block overflow-hidden h-4 rounded-full bg-slate-700 cursor-pointer"></label>
                                </div>
                            </div>
                            <div v-if="config.showTime" class="flex gap-2 mt-2">
                                <button @click="config.timeFormat = 'YYYY-MM-DD'" :class="['flex-1 py-1.5 text-[10px] rounded border transition', config.timeFormat === 'YYYY-MM-DD' ? 'bg-indigo-600 border-indigo-600 text-white' : 'border-color text-slate-400 hover:border-indigo-500']">YYYY-MM-DD</button>
                                <button @click="config.timeFormat = 'datetime'" :class="['flex-1 py-1.5 text-[10px] rounded border transition', config.timeFormat === 'datetime' ? 'bg-indigo-600 border-indigo-600 text-white' : 'border-color text-slate-400 hover:border-indigo-500']">YYYY-MM-DD HH:MM</button>
                            </div>
                        </div>

                        <!-- Page Number -->
                        <div v-if="currentThemeConfig.pageNumber.editable" class="py-3">
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-[10px] text-slate-500 uppercase font-bold">È°µÁ†ÅÊ†áÁ≠æ</label>
                                <div class="relative inline-block w-8 h-4 align-middle select-none transition duration-200 ease-in">
                                    <input type="checkbox" v-model="config.showPageNumber" class="toggle-checkbox absolute block w-4 h-4 rounded-full bg-white border-4 appearance-none cursor-pointer transition-transform duration-200 ease-in-out" :class="{ 'translate-x-4 border-indigo-600': config.showPageNumber, 'border-slate-400': !config.showPageNumber }"/>
                                    <label class="toggle-label block overflow-hidden h-4 rounded-full bg-slate-700 cursor-pointer"></label>
                                </div>
                            </div>
                            <div v-if="config.showPageNumber" class="flex gap-2 mt-2">
                                <button @click="config.pageNumberFormat = 'number'" :class="['flex-1 py-1.5 text-[10px] rounded border transition', config.pageNumberFormat === 'number' ? 'bg-indigo-600 border-indigo-600 text-white' : 'border-color text-slate-400 hover:border-indigo-500']">1 / n</button>
                                <button @click="config.pageNumberFormat = 'text'" :class="['flex-1 py-1.5 text-[10px] rounded border transition', config.pageNumberFormat === 'text' ? 'bg-indigo-600 border-indigo-600 text-white' : 'border-color text-slate-400 hover:border-indigo-500']">Page n</button>
                            </div>
                        </div>

                        <!-- Watermark -->
                        <div v-if="currentThemeConfig.watermark.editable" class="py-3">
                            <div class="flex justify-between items-center mb-3">
                                <label class="text-[10px] text-slate-500 uppercase font-bold">Ê∞¥Âç∞ËÆæÁΩÆ</label>
                                <div class="relative inline-block w-8 h-4 align-middle select-none transition duration-200 ease-in">
                                    <input type="checkbox" v-model="config.showWatermark" class="toggle-checkbox absolute block w-4 h-4 rounded-full bg-white border-4 appearance-none cursor-pointer transition-transform duration-200 ease-in-out" :class="{ 'translate-x-4 border-indigo-600': config.showWatermark, 'border-slate-400': !config.showWatermark }"/>
                                    <label class="toggle-label block overflow-hidden h-4 rounded-full bg-slate-700 cursor-pointer"></label>
                                </div>
                            </div>
                            <input v-if="config.showWatermark" v-model="config.watermarkText" type="text" class="w-full bg-black/40 border border-color rounded px-3 py-2 text-xs text-slate-300 outline-none focus:border-indigo-500" placeholder="ËæìÂÖ•Ê∞¥Âç∞ÊñáÂ≠ó">
                        </div>
                    </div>
                    <!-- Themes Tab -->
                    <div v-if="leftTab === 'themes'" class="grid grid-cols-2 gap-3">
                        <div v-for="(t, key) in themes" :key="key" 
                            @click="applyTheme(key)"
                            :class="['cursor-pointer rounded-lg border-2 p-3 transition-all', config.theme === key ? 'border-indigo-600 bg-indigo-600/10' : 'border-transparent bg-black/20 hover:bg-black/40']">
                            <!-- ‰∏ªÈ¢òÈ¢ÑËßàÂç°Áâá -->
                            <div class="aspect-[3/4] rounded mb-2 flex flex-col items-center justify-center overflow-hidden relative p-2" 
                                :style="{ background: t.config.canvas.background }">
                                <!-- ÂçäÈÄèÊòéÈÅÆÁΩ© -->
                                <div class="absolute inset-0 bg-black/5"></div>
                                
                                <!-- Ê†áÈ¢òÁ§∫‰æã -->
                                <div class="relative z-10 w-full mb-2 px-2">
                                    <div class="h-1.5 rounded-full mb-1" 
                                        :style="{ background: t.config.title.color, width: '70%', margin: t.config.title.textAlign === 'center' ? '0 auto' : '0' }"></div>
                                </div>
                                
                                <!-- ÂÜÖÂÆπÁ§∫‰æã -->
                                <div class="relative z-10 w-full flex-1 rounded px-2 flex flex-col gap-1"
                                    :style="{ background: t.config.content.backgroundColor, backdropFilter: t.config.content.backdropFilter }">
                                    <div class="h-0.5 rounded-full mt-2" :style="{ background: t.config.content.color, opacity: 0.6, width: '90%' }"></div>
                                    <div class="h-0.5 rounded-full" :style="{ background: t.config.content.color, opacity: 0.5, width: '85%' }"></div>
                                    <div class="h-0.5 rounded-full" :style="{ background: t.config.content.color, opacity: 0.5, width: '80%' }"></div>
                                </div>
                                
                                <!-- Â∫ïÈÉ®Á§∫‰æã -->
                                <div class="relative z-10 w-full mt-2 px-2 flex items-center justify-between">
                                    <div v-if="t.config.author.show" class="flex items-center gap-1">
                                        <div class="w-2 h-2 rounded-full" :style="{ background: t.config.author.nicknameColor }"></div>
                                        <div class="h-0.5 w-6 rounded" :style="{ background: t.config.author.nicknameColor, opacity: 0.7 }"></div>
                                    </div>
                                    <div class="h-0.5 w-4 rounded" :style="{ background: t.config.pageNumber.color, opacity: 0.6 }"></div>
                                </div>
                            </div>
                            
                            <!-- ‰∏ªÈ¢ò‰ø°ÊÅØ -->
                            <div class="space-y-1">
                                <div class="text-[11px] text-center font-medium text-slate-200">{{ t.name }}</div>
                                <div class="text-[9px] text-center text-slate-400">{{ t.preview.description }}</div>
                                <div class="flex flex-wrap gap-1 justify-center mt-1">
                                    <span v-for="feature in t.preview.features" :key="feature" 
                                        class="text-[8px] px-1.5 py-0.5 rounded-full bg-indigo-500/20 text-indigo-300">
                                        {{ feature }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <main class="flex-1 main-bg overflow-y-auto p-12 flex flex-col items-center no-scrollbar relative">
                <div class="absolute top-4 left-1/2 -translate-x-1/2 flex items-center gap-1 bg-black/40 backdrop-blur px-4 py-2 rounded-full border border-color text-xs text-slate-400">
                    <span>Âç°ÁâáÊï∞Èáè: {{ cardChunks.length }}</span>
                    <div class="w-px h-3 bg-slate-700"></div>
                    <span>ÊØî‰æã: {{ ratios[config.ratio].label }}</span>
                </div>

                <div class="grid gap-8 py-2" :style="{ gridTemplateColumns: `repeat(${columnCount}, minmax(0, 1fr))` }">
                    <div v-for="(chunk, index) in cardChunks" :key="index" class="relative group flex justify-center">
                        <div 
                            :id="'card-' + index"
                            :style="cardStyle"
                            class="card-fixed-container overflow-hidden relative"
                        >
                            <!-- Background Layer -->
                            <div class="absolute inset-0 z-0" :style="{ background: outerBackground }"></div>
                            
                            <!-- Inner Container with padding (for teaching theme's layered look) -->
                            <div v-if="currentThemeConfig.author.position === 'top-left'" 
                                class="relative z-10 flex-1 flex flex-col" 
                                :style="{ 
                                    padding: config.padding + 'px',
                                    background: innerBackground,
                                    borderRadius: (config.borderRadius > 0 ? Math.max(0, config.borderRadius - 12) : 0) + 'px'
                                }">
                                <!-- Title Layer with background -->
                                <div :style="{ 
                                    backgroundColor: currentThemeConfig.title.backgroundColor || 'transparent',
                                    padding: currentThemeConfig.title.padding || '20px',
                                    borderRadius: currentThemeConfig.title.borderRadius || '0',
                                    marginBottom: '0'
                                }" class="flex items-center gap-4">
                                    <!-- Avatar -->
                                    <div v-if="config.showAuthor" :style="{ width: currentThemeConfig.author.avatarSize, height: currentThemeConfig.author.avatarSize }" 
                                        class="rounded-full border-3 border-white shadow-lg bg-white flex items-center justify-center overflow-hidden flex-shrink-0">
                                        <img v-if="config.authorAvatar" :key="config.authorAvatar" :src="config.authorAvatar" class="w-full h-full object-cover" />
                                        <svg v-else-if="config.socialIcon" viewBox="0 0 24 24" class="w-10 h-10" :fill="socialIcons.find(s => s.icon === config.socialIcon)?.color">
                                            <path :d="socialIcons.find(s => s.icon === config.socialIcon)?.path"/>
                                        </svg>
                                        <span v-else :style="{ color: currentThemeConfig.author.nicknameColor }" class="font-bold text-2xl">{{ config.authorNickname.charAt(0) }}</span>
                                    </div>
                                    <!-- Title -->
                                    <h1 v-if="currentThemeConfig.title.show && config.title" 
                                        :style="{ 
                                            fontSize: currentThemeConfig.title.fontSize, 
                                            fontFamily: currentThemeConfig.title.fontFamily,
                                            fontWeight: currentThemeConfig.title.fontWeight,
                                            color: currentThemeConfig.title.color,
                                            textAlign: currentThemeConfig.title.textAlign
                                        }" 
                                        class="leading-tight tracking-tight flex-1">{{ config.title }}</h1>
                                </div>

                                <!-- Content Layer (overlapping title layer) -->
                                <div 
                                    class="markdown-body flex-1 overflow-hidden shadow-md"
                                    :style="{
                                        ...contentStyle,
                                        marginTop: currentThemeConfig.content.marginTop || '0',
                                        zIndex: 20,
                                        position: 'relative'
                                    }"
                                    v-html="renderMarkdown(chunk)"
                                ></div>
                                
                                <!-- Footer -->
                                <div class="mt-auto pt-6 flex items-center justify-between relative z-30">
                                    <!-- Left: Watermark for teaching theme -->
                                    <div v-if="config.showWatermark && currentThemeConfig.watermark.position === 'bottom-left'" 
                                        class="flex items-center gap-1.5" 
                                        :style="{ opacity: currentThemeConfig.watermark.opacity }">
                                        <i data-lucide="feather" class="w-3 h-3" :style="{ color: currentThemeConfig.watermark.color }"></i>
                                        <span :style="{ fontSize: currentThemeConfig.watermark.fontSize, color: currentThemeConfig.watermark.color }" 
                                            class="uppercase tracking-widest font-bold">{{ config.watermarkText }}</span>
                                    </div>
                                    
                                    <!-- Right: Page Number for teaching theme -->
                                    <span v-if="config.showPageNumber && currentThemeConfig.watermark.position === 'bottom-left'" 
                                        :style="{ fontSize: currentThemeConfig.pageNumber.fontSize, color: currentThemeConfig.pageNumber.color }" 
                                        class="font-mono font-medium bg-white/80 px-2 py-0.5 rounded-full">{{ getPageNumber(index, cardChunks.length) }}</span>
                                </div>
                            </div>
                            
                            <!-- Traditional layout for other themes -->
                            <div v-else-if="config.theme === 'modern'" class="relative z-10 flex-1 flex flex-col">
                                <div class="modern-knowledge">
                                    <!-- Cover image: only page 1 -->
                                    <div v-if="index === 0" class="modern-knowledge__image">
                                        <img v-if="config.coverImage" :src="config.coverImage" class="w-full h-full object-cover" />
                                        <div v-else class="modern-knowledge__placeholder">ÂõæÁâáÂç†‰ΩçÂå∫Âüü\nÂª∫ËÆÆÂ∞∫ÂØ∏: 480√ó350px\nÂèØÊõøÊç¢‰∏∫‰∫∫Áâ©ÁÖßÁâáÊàñÁõ∏ÂÖ≥ÊèíÂõæ</div>
                                    </div>

                                    <div class="modern-knowledge__body">
                                        <h1 v-if="index === 0 && currentThemeConfig.title.show && config.title"
                                            :style="{
                                                fontSize: currentThemeConfig.title.fontSize,
                                                fontFamily: currentThemeConfig.title.fontFamily,
                                                fontWeight: currentThemeConfig.title.fontWeight,
                                                color: currentThemeConfig.title.color,
                                                textAlign: currentThemeConfig.title.textAlign,
                                                marginBottom: currentThemeConfig.title.marginBottom,
                                                letterSpacing: currentThemeConfig.title.letterSpacing || '0.5px',
                                                lineHeight: currentThemeConfig.title.lineHeight || '1.3'
                                            }"
                                            class="modern-knowledge__title">{{ config.title }}</h1>

                                        <div class="modern-knowledge__desc markdown-body"
                                            :style="{
                                                fontSize: currentThemeConfig.content.fontSize,
                                                fontFamily: currentThemeConfig.content.fontFamily,
                                                fontWeight: currentThemeConfig.content.fontWeight || '400',
                                                color: currentThemeConfig.content.color,
                                                lineHeight: currentThemeConfig.content.lineHeight,
                                                letterSpacing: currentThemeConfig.content.letterSpacing || '0.3px'
                                            }"
                                            v-html="renderMarkdown(chunk)"></div>

                                        <div class="modern-knowledge__footer" v-if="config.showWatermark">
                                            <div class="modern-knowledge__divider"></div>
                                            <p class="modern-knowledge__signature"
                                                :style="{ fontSize: currentThemeConfig.watermark.fontSize, color: currentThemeConfig.watermark.color, opacity: currentThemeConfig.watermark.opacity }">‚Äî‚Äî {{ config.watermarkText }} ‚Äî‚Äî</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div v-else class="relative z-10 flex-1 flex flex-col p-12">
                                <!-- Traditional Top Title (for other themes) -->
                                <h1 v-if="currentThemeConfig.title.show && config.title" 
                                    :style="{ 
                                        fontSize: currentThemeConfig.title.fontSize, 
                                        fontFamily: currentThemeConfig.title.fontFamily,
                                        fontWeight: currentThemeConfig.title.fontWeight,
                                        color: currentThemeConfig.title.color,
                                        textAlign: currentThemeConfig.title.textAlign,
                                        marginBottom: currentThemeConfig.title.marginBottom
                                    }" 
                                    class="leading-tight tracking-tight">{{ config.title }}</h1>

                                <!-- Content -->
                                <div 
                                    class="markdown-body flex-1 overflow-hidden"
                                    :style="contentStyle"
                                    v-html="renderMarkdown(chunk)"
                                ></div>
                                
                                <!-- Footer (Social Badge) -->
                                <div class="mt-auto pt-8 flex items-center justify-between">
                                    <!-- Left: Author & Time (only show if not top-left position) -->
                                    <div class="flex items-center gap-3">
                                        <!-- Author -->
                                        <div v-if="config.showAuthor && currentThemeConfig.author.position !== 'top-left'" class="flex items-center gap-3">
                                            <!-- Avatar: Custom Image or Social Icon -->
                                            <div :style="{ width: currentThemeConfig.author.avatarSize, height: currentThemeConfig.author.avatarSize }" 
                                                class="rounded-full border-2 border-white shadow-sm bg-indigo-50 flex items-center justify-center overflow-hidden">
                                                <img v-if="config.authorAvatar" :key="config.authorAvatar" :src="config.authorAvatar" class="w-full h-full object-cover" />
                                                <svg v-else-if="config.socialIcon" viewBox="0 0 24 24" class="w-6 h-6" :fill="socialIcons.find(s => s.icon === config.socialIcon)?.color">
                                                    <path :d="socialIcons.find(s => s.icon === config.socialIcon)?.path"/>
                                                </svg>                                                </svg>
                                                <span v-else :style="{ color: currentThemeConfig.author.nicknameColor }" class="font-bold text-sm">{{ config.authorNickname.charAt(0) }}</span>
                                            </div>
                                            <div class="flex flex-col">
                                                <span :style="{ fontSize: currentThemeConfig.author.nicknameSize, color: currentThemeConfig.author.nicknameColor }" 
                                                    class="font-bold leading-none mb-1">{{ config.authorNickname }}</span>
                                                <div class="flex items-center gap-2">
                                                    <span :style="{ fontSize: currentThemeConfig.author.usernameSize, color: currentThemeConfig.author.usernameColor }" 
                                                        class="font-medium">{{ config.authorUsername }}</span>
                                                    <span v-if="config.showTime" :style="{ fontSize: currentThemeConfig.time.fontSize, color: currentThemeConfig.time.color }">‚Ä¢</span>
                                                    <span v-if="config.showTime" :style="{ fontSize: currentThemeConfig.time.fontSize, color: currentThemeConfig.time.color }" 
                                                        class="font-medium">{{ currentTime }}</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Time only if no author -->
                                        <span v-if="!config.showAuthor && config.showTime" 
                                            :style="{ fontSize: currentThemeConfig.time.fontSize, color: currentThemeConfig.time.color }" 
                                            class="font-medium">{{ currentTime }}</span>
                                    </div>

                                    <!-- Right: Page & Watermark -->
                                    <div v-if="currentThemeConfig.watermark.position === 'bottom-right'" class="flex flex-col items-end gap-1">
                                         <div v-if="config.showWatermark" class="flex items-center gap-1.5" :style="{ opacity: currentThemeConfig.watermark.opacity }">
                                            <i data-lucide="feather" class="w-3 h-3" :style="{ color: currentThemeConfig.watermark.color }"></i>
                                            <span :style="{ fontSize: currentThemeConfig.watermark.fontSize, color: currentThemeConfig.watermark.color }" 
                                                class="uppercase tracking-widest font-bold">{{ config.watermarkText }}</span>
                                         </div>
                                         <span v-if="config.showPageNumber" 
                                            :style="{ fontSize: currentThemeConfig.pageNumber.fontSize, color: currentThemeConfig.pageNumber.color }" 
                                            class="font-mono font-medium bg-slate-100/50 px-2 py-0.5 rounded-full">{{ getPageNumber(index, cardChunks.length) }}</span>
                                    </div>
                                    
                                    <!-- Left watermark + Right page number (for teaching theme) -->
                                    <template v-if="currentThemeConfig.watermark.position === 'bottom-left'">
                                        <div v-if="config.showWatermark" class="flex items-center gap-1.5" :style="{ opacity: currentThemeConfig.watermark.opacity }">
                                            <i data-lucide="feather" class="w-3 h-3" :style="{ color: currentThemeConfig.watermark.color }"></i>
                                            <span :style="{ fontSize: currentThemeConfig.watermark.fontSize, color: currentThemeConfig.watermark.color }" 
                                                class="uppercase tracking-widest font-bold">{{ config.watermarkText }}</span>
                                        </div>
                                        <span v-if="config.showPageNumber" 
                                            :style="{ fontSize: currentThemeConfig.pageNumber.fontSize, color: currentThemeConfig.pageNumber.color }" 
                                            class="font-mono font-medium bg-white/80 px-2 py-0.5 rounded-full">{{ getPageNumber(index, cardChunks.length) }}</span>
                                    </template>
                                </div>
                            </div>
                        </div>
                        
                        <button @click="downloadSingleCard(index)" class="absolute -right-12 top-0 p-2 bg-white/10 hover:bg-indigo-600 rounded-full transition-all opacity-0 group-hover:opacity-100">
                            <i data-lucide="download" class="w-4 h-4 text-white"></i>
                        </button>
                    </div>
                </div>
            </main>

            <aside class="w-72 sidebar-bg border-l border-color flex flex-col shrink-0 overflow-y-auto no-scrollbar">
                <div class="p-4 border-b border-color">
                    <h3 class="text-xs font-bold text-indigo-500 uppercase tracking-widest">Â±ûÊÄßËÆæÁΩÆ</h3>
                </div>
                
                <div class="p-4 space-y-6">
                    <div>
                        <label class="text-[10px] text-slate-500 uppercase font-bold block mb-3">ÁîªÂ∏ÉÊØî‰æã</label>
                        <div class="grid grid-cols-4 gap-2">
                            <button v-for="(r, key) in ratios" :key="key"
                                @click="config.ratio = key"
                                :class="['relative bg-black/40 border-2 rounded-lg p-3 transition-all hover:bg-black/60', config.ratio === key ? 'border-indigo-500 bg-indigo-500/20' : 'border-color']"
                                :title="r.label">
                                <div class="w-full flex items-center justify-center">
                                    <div class="border-2 border-slate-400"
                                         :style="{ aspectRatio: r.cssRatio, width: key.includes('16') || key.includes('21') ? '24px' : '20px', maxHeight: '32px' }"
                                         :class="['rounded-sm', config.ratio === key ? 'border-indigo-400' : '']"></div>
                                </div>
                                <div class="text-[9px] text-center mt-1.5 font-medium"
                                     :class="config.ratio === key ? 'text-indigo-300' : 'text-slate-500'">{{ r.label }}</div>
                            </button>
                        </div>
                    </div>

                    <div>
                        <label class="text-[10px] text-slate-500 uppercase font-bold block mb-3">ËÉåÊôØÈÖçËâ≤</label>
                        <div class="grid grid-cols-7 gap-1.5">
                            <button v-for="bg in backgrounds" :key="bg.value" 
                                @click="config.background = bg.value"
                                :style="{ background: bg.value }"
                                :class="['w-full aspect-square rounded-lg border-2 transition-all hover:scale-105', config.background === bg.value ? 'border-indigo-500 ring-2 ring-indigo-500/50' : 'border-transparent']">
                            </button>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <label class="text-[10px] text-slate-500 uppercase font-bold block">ÂÆπÂô®ËÆæÁΩÆ</label>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-slate-400">ÂÜÖËæπË∑ù</span>
                                <div class="flex items-center gap-2">
                                    <input type="range" v-model="config.padding" min="20" max="80" class="w-20 accent-indigo-600">
                                    <span class="text-xs font-mono text-slate-300 w-12 text-right">{{ config.padding }}px</span>
                                </div>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-slate-400">ÂúÜËßí</span>
                                <div class="flex items-center gap-2">
                                    <input type="range" v-model="config.borderRadius" min="0" max="40" class="w-20 accent-indigo-600">
                                    <span class="text-xs font-mono text-slate-300 w-12 text-right">{{ config.borderRadius }}px</span>
                                </div>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-slate-400">Áº©ÊîæÊØî‰æã</span>
                                <div class="flex items-center gap-2">
                                    <input type="range" v-model="canvasScale" min="30" max="100" class="w-20 accent-indigo-600">
                                    <span class="text-xs font-mono text-slate-300 w-12 text-right">{{ canvasScale }}%</span>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
            </aside>
        </div>
    </div>

    <script src="./js/app.js"></script>
    <!--
        const { createApp, ref, computed, watch, onMounted, nextTick } = Vue;

        createApp({
            setup() {
                const leftTab = ref('content');
                const markdownInput = ref(`# Êé¢Á¥¢Êûó‰π¶Âç°Áâá

ËøôÊòØ‰∏ÄÊ¨æ‰∏ì‰∏∫Ëá™Â™í‰ΩìÂÜÖÂÆπÂàõ‰ΩúËÄÖËÆæËÆ°ÁöÑÂç°ÁâáÁîüÊàêÂ∑•ÂÖ∑„ÄÇ

## Ê†∏ÂøÉ‰ºòÂäø
- **Âõ∫ÂÆöÁîªÂ∏É**Ôºö‰∏•Ê†ºÈÅµÂæ™ÊØî‰æãÔºå‰∏çÈöèÂÜÖÂÆπ‰º∏Áº©ÔºåÈÄÇÈÖçÂêÑÂ§ßÂπ≥Âè∞
- **‰∏âÂàóÂ∏ÉÂ±Ä**ÔºöÊ≤âÊµ∏ÂºèÁºñËæë‰ΩìÈ™åÔºåÂ∑¶‰æß‰øÆÊîπÂè≥‰æßÂÆûÊó∂È¢ÑËßà
- **Ëá™Âä®ÂàÜÈ°µ**ÔºöÈïøÊñáÊô∫ËÉΩÂàáÂâ≤ÔºåÂ§öÈ°µÂç°ÁâáÈ£éÊ†ºÈ´òÂ∫¶Áªü‰∏Ä

### Âø´ÈÄüÂºÄÂßã
1. Âú®Â∑¶‰æßËæìÂÖ•ÊÇ®ÁöÑ Markdown ÊñáÊú¨
2. Âú®Âè≥‰æß‚ÄúÊ®°Êùø‚ÄùÊ†èÂàáÊç¢‰∏ªÈ¢ò
3. ÁÇπÂáªÂè≥‰∏äËßí‚ÄúÂØºÂá∫‚ÄùÊåâÈíÆÔºå‰∏ÄÈîÆÊâìÂåÖ‰∏ãËΩΩ

---
ËøôÊòØÁ¨¨‰∫åÈ°µÁöÑÂÜÖÂÆπÔºåÊºîÁ§∫Ëá™Âä®ÂàÜÈ°µÊïàÊûú„ÄÇÊÇ®ÂèØ‰ª•ÁªßÁª≠Âú®ËøôÈáå‰π¶ÂÜôÊÇ®ÁöÑÂπ≤Ë¥ßÂÜÖÂÆπ„ÄÇ`);

                const config = ref({
                    // Content
                    title: 'Êé¢Á¥¢Êûó‰π¶Âç°Áâá',
                    
                    // Author Badge
                    showAuthor: true,
                    authorNickname: 'Êûó‰π¶',
                    authorUsername: '@LinshuTech',
                    authorAvatar: '', // DataURL or empty
                    socialIcon: '', // Selected social media icon
                    
                    // Time & Page
                    showTime: false,
                    timeFormat: 'YYYY-MM-DD',
                    showPageNumber: true,
                    pageNumberFormat: 'number', // 1 / n
                    
                    // Watermark
                    showWatermark: true,
                    watermarkText: 'Êûó‰π¶Âç°Áâá',

                    // Style
                    ratio: '1:1',
                    theme: 'modern',
                    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    padding: 48,
                    borderRadius: 24,
                    fontFamily: 'Inter',
                    textAlign: 'left'
                });

                                // ‰∏ªÈ¢òÊï∞ÊçÆ - JSON Â≠óÁ¨¶‰∏≤ÂÜÖËÅî‰Ωú‰∏∫ file:// ÂõûÈÄÄÔºå‰ºòÂÖà‰ªé themes/*.json Ë¶ÜÁõñ
                                const builtInThemes = JSON.parse(String.raw`{
    "dark": {
        "name": "Ê∑±ÈÇÉÈªë",
        "preview": {
            "description": "Á•ûÁßò‰ºòÈõÖÔºåÈÄÇÂêàÁßëÊäÄÂíåËÆæËÆ°",
            "features": [
                "Ê∑±Ëâ≤ËÉåÊôØ",
                "ÂçäÈÄèÊòé",
                "È´òÂØπÊØî"
            ]
        },
        "config": {
            "title": {
                "show": true,
                "editable": true,
                "fontSize": "1.8rem",
                "fontFamily": "Inter",
                "fontWeight": "bold",
                "color": "#f8fafc",
                "textAlign": "left",
                "marginBottom": "2rem"
            },
            "content": {
                "show": true,
                "editable": true,
                "fontSize": "18px",
                "fontFamily": "Inter",
                "color": "#f8fafc",
                "textAlign": "left",
                "lineHeight": "1.7",
                "maxCharsPerLine": 22,
                "backgroundColor": "rgba(0,0,0,0.6)",
                "backdropFilter": "blur(12px)",
                "padding": "48px",
                "borderRadius": "16px"
            },
            "author": {
                "show": true,
                "editable": true,
                "position": "bottom-left",
                "avatarSize": "40px",
                "nicknameSize": "14px",
                "nicknameColor": "#f8fafc",
                "usernameSize": "10px",
                "usernameColor": "#94a3b8",
                "allowCustomAvatar": true,
                "allowSocialIcon": true
            },
            "time": {
                "show": false,
                "editable": true,
                "position": "with-author",
                "format": "YYYY-MM-DD",
                "fontSize": "10px",
                "color": "#64748b"
            },
            "pageNumber": {
                "show": true,
                "editable": true,
                "position": "bottom-right",
                "format": "number",
                "fontSize": "10px",
                "color": "#64748b"
            },
            "watermark": {
                "show": true,
                "editable": true,
                "position": "bottom-right",
                "text": "Êûó‰π¶Âç°Áâá",
                "fontSize": "10px",
                "color": "#64748b",
                "opacity": 0.5
            },
            "canvas": {
                "background": "#1e1e1e",
                "padding": 48,
                "borderRadius": 24,
                "bgType": "dark"
            }
        }
    },
    "elegant": {
        "name": "‰ºòÈõÖË°¨Á∫ø",
        "preview": {
            "description": "ÊñáÂ≠¶Ê≠£ÂºèÔºåÈÄÇÂêàÈïøÊñáÈòÖËØª",
            "features": [
                "ÁôΩÂ∫ïÈªëÂ≠ó",
                "Ë°¨Á∫øÂ≠ó‰Ωì",
                "Ê†áÈ¢òÂ±Ö‰∏≠"
            ]
        },
        "config": {
            "title": {
                "show": true,
                "editable": true,
                "fontSize": "2rem",
                "fontFamily": "serif",
                "fontWeight": "bold",
                "color": "#2d3436",
                "textAlign": "center",
                "marginBottom": "2.5rem"
            },
            "content": {
                "show": true,
                "editable": true,
                "fontSize": "20px",
                "fontFamily": "serif",
                "color": "#2d3436",
                "textAlign": "left",
                "lineHeight": "1.8",
                "maxCharsPerLine": 20,
                "backgroundColor": "rgba(255,255,255,0.95)",
                "backdropFilter": "blur(8px)",
                "padding": "60px",
                "borderRadius": "8px"
            },
            "author": {
                "show": true,
                "editable": true,
                "position": "bottom-center",
                "avatarSize": "36px",
                "nicknameSize": "13px",
                "nicknameColor": "#2d3436",
                "usernameSize": "10px",
                "usernameColor": "#636e72",
                "allowCustomAvatar": true,
                "allowSocialIcon": false
            },
            "time": {
                "show": true,
                "editable": true,
                "position": "with-author",
                "format": "YYYY-MM-DD",
                "fontSize": "9px",
                "color": "#636e72"
            },
            "pageNumber": {
                "show": true,
                "editable": true,
                "position": "bottom-right",
                "format": "text",
                "fontSize": "9px",
                "color": "#636e72"
            },
            "watermark": {
                "show": false,
                "editable": false,
                "position": "bottom-right",
                "text": "",
                "fontSize": "9px",
                "color": "#636e72",
                "opacity": 0.3
            },
            "canvas": {
                "background": "#ffffff",
                "padding": 60,
                "borderRadius": 0,
                "bgType": "light"
            }
        }
    },
    "modern": {
        "name": "Áé∞‰ª£ÁÆÄÁ∫¶",
        "preview": {
            "description": "Ê∏ÖÁàΩÁÆÄÊ¥ÅÔºåÈÄÇÂêàÂïÜÂä°ÂíåÊïôËÇ≤",
            "features": [
                "ÊµÖËâ≤ËÉåÊôØ",
                "InterÂ≠ó‰Ωì",
                "ÊòæÁ§∫‰ΩúËÄÖ"
            ]
        },
        "config": {
            "title": {
                "show": true,
                "editable": true,
                "fontSize": "1.8rem",
                "fontFamily": "Inter",
                "fontWeight": "bold",
                "color": "#1e293b",
                "textAlign": "left",
                "marginBottom": "2rem"
            },
            "content": {
                "show": true,
                "editable": true,
                "fontSize": "18px",
                "fontFamily": "Inter",
                "color": "#1e293b",
                "textAlign": "left",
                "lineHeight": "1.7",
                "maxCharsPerLine": 22,
                "backgroundColor": "rgba(255,255,255,0.9)",
                "backdropFilter": "blur(12px)",
                "padding": "48px",
                "borderRadius": "16px"
            },
            "author": {
                "show": true,
                "editable": true,
                "position": "bottom-left",
                "avatarSize": "40px",
                "nicknameSize": "14px",
                "nicknameColor": "#1e293b",
                "usernameSize": "10px",
                "usernameColor": "#64748b",
                "allowCustomAvatar": true,
                "allowSocialIcon": true
            },
            "time": {
                "show": false,
                "editable": true,
                "position": "with-author",
                "format": "YYYY-MM-DD",
                "fontSize": "10px",
                "color": "#94a3b8"
            },
            "pageNumber": {
                "show": true,
                "editable": true,
                "position": "bottom-right",
                "format": "number",
                "fontSize": "10px",
                "color": "#94a3b8"
            },
            "watermark": {
                "show": true,
                "editable": true,
                "position": "bottom-right",
                "text": "Êûó‰π¶Âç°Áâá",
                "fontSize": "10px",
                "color": "#94a3b8",
                "opacity": 0.5
            },
            "canvas": {
                "background": "linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)",
                "padding": 48,
                "borderRadius": 24,
                "bgType": "light"
            }
        }
    },
    "scholarly": {
        "name": "‰π¶È¶ôÂ¢®Èüµ",
        "preview": {
            "description": "ÁªèÂÖ∏ÈòÖËØª‰ΩìÈ™åÔºåÈÄÇÂêàÈïøÊñáÊ∑±Â∫¶ÈòÖËØª",
            "features": [
                "ÈªëÁôΩÁÆÄÁ∫¶",
                "Â§ßÂ≠óÂè∑",
                "ËçßÂÖâÂº∫Ë∞É"
            ]
        },
        "config": {
            "title": {
                "show": true,
                "editable": true,
                "fontSize": "26px",
                "fontFamily": "-apple-system, BlinkMacSystemFont, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif",
                "fontWeight": "800",
                "color": "#1a1a1a",
                "textAlign": "center",
                "marginBottom": "2rem",
                "borderTop": "3px solid #1a1a1a",
                "borderBottom": "3px solid #1a1a1a",
                "padding": "18px 0",
                "letterSpacing": "3px"
            },
            "content": {
                "show": true,
                "editable": true,
                "fontSize": "18px",
                "fontFamily": "-apple-system, BlinkMacSystemFont, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif",
                "color": "#2a2a2a",
                "textAlign": "justify",
                "lineHeight": "1.95",
                "maxCharsPerLine": 22,
                "backgroundColor": "#f8f8f8",
                "backdropFilter": "none",
                "padding": "48px",
                "borderRadius": "6px"
            },
            "author": {
                "show": true,
                "editable": true,
                "position": "bottom-left",
                "avatarSize": "40px",
                "nicknameSize": "14px",
                "nicknameColor": "#1a1a1a",
                "usernameSize": "10px",
                "usernameColor": "#404040",
                "allowCustomAvatar": true,
                "allowSocialIcon": true
            },
            "time": {
                "show": true,
                "editable": true,
                "position": "with-author",
                "format": "YYYY-MM-DD",
                "fontSize": "10px",
                "color": "#888"
            },
            "pageNumber": {
                "show": true,
                "editable": true,
                "position": "bottom-right",
                "format": "number",
                "fontSize": "10px",
                "color": "#1a1a1a"
            },
            "watermark": {
                "show": true,
                "editable": true,
                "position": "bottom-right",
                "text": "‰π¶È¶ôÂ¢®Èüµ",
                "fontSize": "10px",
                "color": "#999",
                "opacity": 0.5
            },
            "canvas": {
                "background": "#ffffff",
                "padding": 48,
                "borderRadius": 0,
                "bgType": "light"
            },
            "markdown": {
                "h2": {
                    "fontSize": "20px",
                    "padding": "0.3em 1em",
                    "borderRadius": "30px",
                    "boxShadow": "0 4px 6px rgba(0, 0, 0, 0.1)"
                },
                "h3": {
                    "fontSize": "18px",
                    "borderLeft": "5px solid #1a1a1a",
                    "paddingLeft": "20px",
                    "background": "linear-gradient(to right, rgba(26, 26, 26, 0.04), transparent 50%)"
                },
                "strong": {
                    "background": "linear-gradient(to bottom, transparent 65%, rgba(255, 235, 59, 0.7) 65%)",
                    "color": "#1a1a1a"
                },
                "blockquote": {
                    "background": "#f8f8f8",
                    "borderLeft": "5px solid #eee",
                    "color": "#888"
                }
            }
        }
    },
    "teaching": {
        "name": "ÊïôÂ≠¶Âç°Áâá",
        "preview": {
            "description": "ÊïôÂ≠¶ÂàÜ‰∫´‰∏ìÁî®ÔºåÂ§¥ÂÉèÂº∫Âåñ",
            "features": [
                "ËìùËâ≤Ê∏êÂèò",
                "Â§¥ÂÉèÁ™ÅÂá∫",
                "Ê∞¥Âç∞Â∑¶‰∏ã"
            ]
        },
        "config": {
            "title": {
                "show": true,
                "editable": false,
                "fontSize": "1.65rem",
                "fontFamily": "Noto Sans SC",
                "fontWeight": "bold",
                "color": "#2c3e50",
                "textAlign": "left",
                "marginBottom": "0",
                "backgroundColor": "#e8eaf0",
                "padding": "20px 24px",
                "borderRadius": "16px 16px 0 0"
            },
            "content": {
                "show": true,
                "editable": false,
                "fontSize": "18px",
                "fontFamily": "MapleMono-NF-CN-Light, 'Noto Sans SC', 'PingFang SC', 'Microsoft YaHei', sans-serif",
                "fontWeight": "300",
                "color": "#2d3436",
                "textAlign": "left",
                "lineHeight": "1.7",
                "maxCharsPerLine": 26,
                "backgroundColor": "#ffffff",
                "backdropFilter": "none",
                "padding": "32px",
                "borderRadius": "16px",
                "marginTop": "-12px"
            },
            "author": {
                "show": true,
                "editable": true,
                "position": "top-left",
                "avatarSize": "70px",
                "nicknameSize": "0",
                "nicknameColor": "transparent",
                "usernameSize": "0",
                "usernameColor": "transparent",
                "allowCustomAvatar": true,
                "allowSocialIcon": true
            },
            "time": {
                "show": false,
                "editable": false,
                "position": "with-author",
                "format": "YYYY-MM-DD",
                "fontSize": "10px",
                "color": "#94a3b8"
            },
            "pageNumber": {
                "show": true,
                "editable": true,
                "position": "bottom-right",
                "format": "number",
                "fontSize": "11px",
                "color": "#5a6c7d"
            },
            "watermark": {
                "show": true,
                "editable": true,
                "position": "bottom-left",
                "text": "Êûó‰π¶Âç°Áâá",
                "fontSize": "9px",
                "color": "#94a3b8",
                "opacity": 0.5
            },
            "canvas": {
                "ratio": "3:4",
                "outerBackground": "linear-gradient(135deg, #4a90e2 0%, #357abd 100%)",
                "background": "#3C67B0",
                "padding": 36,
                "borderRadius": 32,
                "canvasScale": 80,
                "bgType": "light",
                "backgroundTarget": "inner",
                "innerPadding": 24,
                "innerRadius": 20
            }
        },
        "layout": {
            "type": "layered",
            "structure": [
                {
                    "layer": "outer",
                    "element": "background",
                    "editable": true,
                    "description": "Â§ñÂ±ÇËìùËâ≤Ê∏êÂèòËæπÊ°Ü"
                },
                {
                    "layer": "inner",
                    "element": "container",
                    "editable": false,
                    "description": "ÊµÖÁÅ∞Ëâ≤ÂÜÖÈÉ®ÂÆπÂô®"
                },
                {
                    "layer": "title",
                    "element": "header",
                    "editable": false,
                    "description": "Ê†áÈ¢òÂ±ÇÔºàÊµÖÁÅ∞ËÉåÊôØ+Â§¥ÂÉè+Ê†áÈ¢òÔºâ"
                },
                {
                    "layer": "content",
                    "element": "main",
                    "editable": false,
                    "description": "Ê≠£ÊñáÂ±ÇÔºàÁôΩËâ≤Âç°ÁâáÔºåÂêë‰∏äË¶ÜÁõñÔºâ"
                },
                {
                    "layer": "footer",
                    "element": "meta",
                    "editable": true,
                    "description": "Â∫ïÈÉ®ÂÖÉ‰ø°ÊÅØÔºàÊ∞¥Âç∞Â∑¶+È°µÁ†ÅÂè≥Ôºâ"
                }
            ]
        },
        "permissions": {
            "title": {
                "toggle": false,
                "edit": false,
                "style": false
            },
            "content": {
                "toggle": false,
                "edit": false,
                "style": false
            },
            "author": {
                "toggle": true,
                "uploadAvatar": true,
                "selectIcon": true,
                "showName": false
            },
            "time": {
                "toggle": false,
                "format": false
            },
            "pageNumber": {
                "toggle": true,
                "format": true
            },
            "watermark": {
                "toggle": true,
                "editText": true
            },
            "canvas": {
                "background": true,
                "padding": true,
                "borderRadius": true,
                "ratio": true
            }
        },
        "design": {
            "colorScheme": {
                "primary": "#4a90e2",
                "secondary": "#357abd",
                "background": "#3C67B0",
                "titleBg": "#e8eaf0",
                "contentBg": "#ffffff",
                "text": "#2c3e50",
                "textSecondary": "#5a6c7d",
                "border": "#ffffff"
            },
            "typography": {
                "titleFont": "Noto Sans SC",
                "contentFont": "Noto Sans SC",
                "titleSize": "1.65rem",
                "contentSize": "15px",
                "lineHeight": "1.7"
            },
            "spacing": {
                "outerPadding": 36,
                "innerPadding": 24,
                "contentPadding": 32,
                "titlePadding": "20px 24px"
            },
            "effects": {
                "avatarBorder": "3px solid #ffffff",
                "avatarShadow": "0 4px 6px rgba(0,0,0,0.1)",
                "contentShadow": "0 2px 8px rgba(0,0,0,0.08)",
                "contentOverlap": "-12px"
            }
        }
    },
    "vibrant": {
        "name": "Áº§Á∫∑ÂàõÊÑè",
        "preview": {
            "description": "ÂΩ©Ëâ≤Ê∏êÂèòÔºåÈÄÇÂêàÂàõÊÑèÂ±ïÁ§∫",
            "features": [
                "Ê∏êÂèòËÉåÊôØ",
                "ÊØõÁéªÁíÉ",
                "È´òÈ•±Âíå"
            ]
        },
        "config": {
            "title": {
                "show": true,
                "editable": true,
                "fontSize": "1.8rem",
                "fontFamily": "Inter",
                "fontWeight": "bold",
                "color": "#ffffff",
                "textAlign": "left",
                "marginBottom": "2rem"
            },
            "content": {
                "show": true,
                "editable": true,
                "fontSize": "18px",
                "fontFamily": "Inter",
                "color": "#ffffff",
                "textAlign": "left",
                "lineHeight": "1.7",
                "maxCharsPerLine": 22,
                "backgroundColor": "rgba(255,255,255,0.15)",
                "backdropFilter": "blur(20px)",
                "padding": "40px",
                "borderRadius": "24px"
            },
            "author": {
                "show": true,
                "editable": true,
                "position": "bottom-left",
                "avatarSize": "40px",
                "nicknameSize": "14px",
                "nicknameColor": "#ffffff",
                "usernameSize": "10px",
                "usernameColor": "rgba(255,255,255,0.7)",
                "allowCustomAvatar": true,
                "allowSocialIcon": true
            },
            "time": {
                "show": false,
                "editable": true,
                "position": "with-author",
                "format": "YYYY-MM-DD",
                "fontSize": "10px",
                "color": "rgba(255,255,255,0.6)"
            },
            "pageNumber": {
                "show": true,
                "editable": true,
                "position": "bottom-right",
                "format": "number",
                "fontSize": "10px",
                "color": "rgba(255,255,255,0.6)"
            },
            "watermark": {
                "show": true,
                "editable": true,
                "position": "bottom-right",
                "text": "Êûó‰π¶Âç°Áâá",
                "fontSize": "10px",
                "color": "rgba(255,255,255,0.5)",
                "opacity": 0.5
            },
            "canvas": {
                "background": "linear-gradient(to right, #4facfe 0%, #00f2fe 100%)",
                "padding": 40,
                "borderRadius": 32,
                "bgType": "dark"
            }
        }
    }
}`);
                                const themes = ref(builtInThemes);
                const loadExternalThemes = async () => {
                    if (window.location.protocol === 'file:') {
                        return; // Áõ¥Êé•ÊâìÂºÄÊú¨Âú∞Êñá‰ª∂Êó∂‰øùÊåÅÂÜÖÁΩÆÈÖçÁΩÆÔºåÈÅøÂÖç fetch Êä•Èîô
                    }
                    const themeKeys = Object.keys(themes.value);
                    await Promise.all(themeKeys.map(async (key) => {
                        try {
                            const response = await fetch(`./themes/${key}.json`, { cache: 'no-cache' });
                            if (!response.ok) {
                                throw new Error(`HTTP ${response.status}`);
                            }
                            const data = await response.json();
                            if (data?.config) {
                                themes.value[key] = data;
                            }
                        } catch (error) {
                            console.warn(`‰∏ªÈ¢ò ${key} Âä†ËΩΩÂ§±Ë¥•ÔºåÂ∞Ü‰ΩøÁî®ÂÜÖÁΩÆÈÖçÁΩÆ`, error);
                        }
                    }));
                };

                // Social icons using inline SVG paths
                const socialIcons = [
                    { name: 'ÂæÆ‰ø°', icon: 'wechat', color: '#09B83E', path: 'M8.5 5c-2.5 0-4.5 1.5-4.5 3.5 0 1.2 0.8 2.3 2 2.9l-0.5 1.6 1.8-0.9c0.4 0.1 0.8 0.2 1.2 0.2 2.5 0 4.5-1.5 4.5-3.5S11 5 8.5 5zm-1 4.8c-0.3 0-0.5-0.2-0.5-0.5s0.2-0.5 0.5-0.5 0.5 0.2 0.5 0.5-0.2 0.5-0.5 0.5zm2 0c-0.3 0-0.5-0.2-0.5-0.5s0.2-0.5 0.5-0.5 0.5 0.2 0.5 0.5-0.2 0.5-0.5 0.5z' },
                    { name: 'QQ', icon: 'qq', color: '#12B7F5', path: 'M12 2c-3.3 0-6 2.7-6 6 0 0.8 0.2 1.6 0.5 2.3-1.5 0.5-2.5 1.5-2.5 2.7 0 0.8 0.5 1.5 1.3 2 -0.1 0.3-0.2 0.7-0.2 1 0 1.1 0.9 2 2 2 0.5 0 1-0.2 1.4-0.5 0.5 0.1 1 0.2 1.5 0.2s1-0.1 1.5-0.2c0.4 0.3 0.9 0.5 1.4 0.5 1.1 0 2-0.9 2-2 0-0.3-0.1-0.7-0.2-1 0.8-0.5 1.3-1.2 1.3-2 0-1.2-1-2.2-2.5-2.7 0.3-0.7 0.5-1.5 0.5-2.3 0-3.3-2.7-6-6-6z' },
                    { name: 'ÂæÆÂçö', icon: 'weibo', color: '#E6162D', path: 'M14.5 8c0.8 0 1.5-0.7 1.5-1.5S15.3 5 14.5 5 13 5.7 13 6.5 13.7 8 14.5 8zm-4 8c-3 0-5.5-1.8-5.5-4s2.5-4 5.5-4 5.5 1.8 5.5 4-2.5 4-5.5 4zm0-6c-1.9 0-3.5 0.9-3.5 2s1.6 2 3.5 2 3.5-0.9 3.5-2-1.6-2-3.5-2z' },
                    { name: 'ÊäñÈü≥', icon: 'douyin', color: '#000000', path: 'M19 8v6c0 1.1-0.9 2-2 2h-2v2h-2v-2H9v2H7v-2H5c-1.1 0-2-0.9-2-2V8c0-1.1 0.9-2 2-2h2V4h2v2h4V4h2v2h2c1.1 0 2 0.9 2 2zm-2 0H5v6h12V8z' },
                    { name: 'Âø´Êâã', icon: 'kuaishou', color: '#FF6600', path: 'M12 2L3 7v5c0 5.5 3.8 10.7 9 12 5.2-1.3 9-6.5 9-12V7l-9-5zm0 3.2l6 3.4v4.4c0 3.7-2.5 7.2-6 8.2-3.5-1-6-4.5-6-8.2V8.6l6-3.4z' },
                    { name: 'Â∞èÁ∫¢‰π¶', icon: 'xiaohongshu', color: '#FF2442', path: 'M20 4H4c-1.1 0-2 0.9-2 2v12c0 1.1 0.9 2 2 2h16c1.1 0 2-0.9 2-2V6c0-1.1-0.9-2-2-2zm-9 13H9v-7h2v7zm4 0h-2v-7h2v7zm4 0h-2V9h2v8z' },
                    { name: 'Twitter', icon: 'twitter', color: '#1DA1F2', path: 'M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z' },
                    { name: 'Facebook', icon: 'facebook', color: '#1877F2', path: 'M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z' },
                    { name: 'Instagram', icon: 'instagram', color: '#E4405F', path: 'M16 2H8C4.7 2 2 4.7 2 8v8c0 3.3 2.7 6 6 6h8c3.3 0 6-2.7 6-6V8c0-3.3-2.7-6-6-6zm-4 13c-2.8 0-5-2.2-5-5s2.2-5 5-5 5 2.2 5 5-2.2 5-5 5zm6-9c-0.6 0-1-0.4-1-1s0.4-1 1-1 1 0.4 1 1-0.4 1-1 1z' },
                    { name: 'YouTube', icon: 'youtube', color: '#FF0000', path: 'M23 9.7s-0.2-1.7-1-2.4c-0.9-1-2-1-2.4-1C16.4 6 12 6 12 6s-4.4 0-7.6 0.3c-0.5 0-1.5 0-2.4 1-0.7 0.7-1 2.4-1 2.4S1 11.7 1 13.7v2c0 2 0.4 3.9 0.4 3.9s0.2 1.7 1 2.4c0.9 1 2.1 0.9 2.6 1 1.9 0.2 7 0.3 7 0.3s4.4 0 7.6-0.3c0.5 0 1.5 0 2.4-1 0.7-0.7 1-2.4 1-2.4s0.4-1.9 0.4-3.9v-2c0-2-0.4-3.9-0.4-3.9zM10 15.5v-6l6 3-6 3z' },
                    { name: 'GitHub', icon: 'github', color: '#181717', path: 'M12 2C6.5 2 2 6.5 2 12c0 4.4 2.9 8.2 6.8 9.5 0.5 0.1 0.7-0.2 0.7-0.5v-1.7c-2.8 0.6-3.4-1.3-3.4-1.3-0.5-1.1-1.1-1.4-1.1-1.4-0.9-0.6 0.1-0.6 0.1-0.6 1 0.1 1.5 1 1.5 1 0.9 1.5 2.3 1.1 2.9 0.8 0.1-0.6 0.3-1.1 0.6-1.3-2.2-0.3-4.6-1.1-4.6-4.9 0-1.1 0.4-2 1-2.7-0.1-0.2-0.4-1.2 0.1-2.5 0 0 0.8-0.3 2.7 1 0.8-0.2 1.7-0.3 2.5-0.3s1.7 0.1 2.5 0.3c1.9-1.3 2.7-1 2.7-1 0.5 1.3 0.2 2.3 0.1 2.5 0.6 0.7 1 1.6 1 2.7 0 3.8-2.3 4.7-4.6 4.9 0.4 0.3 0.7 0.9 0.7 1.9v2.8c0 0.3 0.2 0.6 0.7 0.5C19.1 20.2 22 16.4 22 12c0-5.5-4.5-10-10-10z' },
                    { name: 'LinkedIn', icon: 'linkedin', color: '#0A66C2', path: 'M20.5 2h-17A1.5 1.5 0 002 3.5v17A1.5 1.5 0 003.5 22h17a1.5 1.5 0 001.5-1.5v-17A1.5 1.5 0 0020.5 2zM8 19H5v-9h3zM6.5 8.25A1.75 1.75 0 118.3 6.5a1.78 1.78 0 01-1.8 1.75zM19 19h-3v-4.74c0-1.42-.6-1.93-1.38-1.93A1.74 1.74 0 0013 14.19a.66.66 0 000 .14V19h-3v-9h2.9v1.3a3.11 3.11 0 012.7-1.4c1.55 0 3.36.86 3.36 3.66z' },
                    { name: 'TikTok', icon: 'tiktok', color: '#000000', path: 'M19 8v6c0 1.1-0.9 2-2 2h-2v2h-2v-2H9v2H7v-2H5c-1.1 0-2-0.9-2-2V8c0-1.1 0.9-2 2-2h2V4h2v2h4V4h2v2h2c1.1 0 2 0.9 2 2zm-2 0H5v6h12V8z' }
                ];

                const handleAvatarUpload = (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            // Crop to square using canvas
                            const img = new Image();
                            img.onload = () => {
                                const size = Math.min(img.width, img.height);
                                const canvas = document.createElement('canvas');
                                canvas.width = size;
                                canvas.height = size;
                                const ctx = canvas.getContext('2d');
                                ctx.drawImage(
                                    img,
                                    (img.width - size) / 2,
                                    (img.height - size) / 2,
                                    size,
                                    size,
                                    0,
                                    0,
                                    size,
                                    size
                                );
                                const dataUrl = canvas.toDataURL('image/png');
                                config.value.authorAvatar = dataUrl;
                                config.value.socialIcon = ''; // Clear social icon when uploading custom avatar
                            };
                            img.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                };

                const selectSocialIcon = (icon) => {
                    config.value.socialIcon = icon;
                    config.value.authorAvatar = ''; // Clear custom avatar when selecting social icon
                };

                const currentTime = computed(() => {
                    const now = new Date();
                    const y = now.getFullYear();
                    const m = String(now.getMonth() + 1).padStart(2, '0');
                    const d = String(now.getDate()).padStart(2, '0');
                    
                    if (config.value.timeFormat === 'YYYY-MM-DD') {
                        return `${y}-${m}-${d}`;
                    } else {
                        const hh = String(now.getHours()).padStart(2, '0');
                        const mm = String(now.getMinutes()).padStart(2, '0');
                        return `${y}-${m}-${d} ${hh}:${mm}`;
                    }
                });

                const getPageNumber = (index, total) => {
                    if (config.value.pageNumberFormat === 'number') {
                        return `${index + 1} / ${total}`;
                    } else {
                        return `Page ${index + 1}`;
                    }
                };

                const isExporting = ref(false);
                const canvasScale = ref(80);

                // ËÆ°ÁÆóÂàóÊï∞ÔºöÊ†πÊçÆÁîªÂ∏ÉÊØî‰æãÂíåÁº©ÊîæÊØî‰æã
                const columnCount = computed(() => {
                    const verticalRatios = ['1:1', '2:3', '3:4', '9:16'];
                    const isVertical = verticalRatios.includes(config.value.ratio);
                    
                    if (!isVertical) {
                        return 1; // Ê®™Â±èÂç°ÁâáÂßãÁªàÂçïÂàó
                    }
                    
                    const scale = canvasScale.value;
                    if (scale >= 70) {
                        return 1; // 70%-100%ÔºöÂçïÂàó
                    } else if (scale >= 40) {
                        return 2; // 40%-69%ÔºöÂèåÂàó
                    } else {
                        return 3; // 30%-39%Ôºö‰∏âÂàó
                    }
                });

                const ratios = {
                    '1:1': { label: '1:1', width: 800, height: 800, maxLines: 10, cssRatio: '1/1' },
                    '2:3': { label: '2:3', width: 600, height: 900, maxLines: 18, cssRatio: '2/3' },
                    '3:4': { label: '3:4', width: 600, height: 800, maxLines: 15, cssRatio: '3/4' },
                    '9:16': { label: '9:16', width: 562, height: 1000, maxLines: 28, cssRatio: '9/16' },
                    '3:2': { label: '3:2', width: 900, height: 600, maxLines: 8, cssRatio: '3/2' },
                    '4:3': { label: '4:3', width: 800, height: 600, maxLines: 8, cssRatio: '4/3' },
                    '16:9': { label: '16:9', width: 1000, height: 562, maxLines: 7, cssRatio: '16/9' },
                    '21:9': { label: '21:9', width: 1050, height: 450, maxLines: 6, cssRatio: '21/9' }
                };

                const fonts = [
                    { label: 'Inter (ÈªòËÆ§)', value: 'Inter' },
                    { label: 'Noto Sans SC (‰∏≠Êñá)', value: 'Noto Sans SC' },
                    { label: 'JetBrains Mono (‰ª£Á†Å)', value: 'JetBrains Mono' },
                    { label: 'Serif (Ë°¨Á∫ø)', value: 'serif' }
                ];

                const alignments = [
                    { value: 'left', icon: 'align-left' },
                    { value: 'center', icon: 'align-center' },
                    { value: 'right', icon: 'align-right' }
                ];



                const backgrounds = [
                    // Row 1 - Á¥´ËìùÊ∏êÂèòÁ≥ª
                    { value: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' },
                    { value: 'linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)' },
                    { value: 'linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%)' },
                    { value: 'linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%)' },
                    { value: 'linear-gradient(to top, #5f72bd 0%, #9b23ea 100%)' },
                    { value: 'linear-gradient(-20deg, #b721ff 0%, #21d4fd 100%)' },
                    { value: 'linear-gradient(to top, #1e3c72 0%, #2a5298 100%)' },
                    
                    // Row 2 - ÈùíÁªøÊ∏êÂèòÁ≥ª
                    { value: 'linear-gradient(135deg, #2af598 0%, #009efd 100%)' },
                    { value: 'linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%)' },
                    { value: 'linear-gradient(to right, #4facfe 0%, #00f2fe 100%)' },
                    { value: 'linear-gradient(to right, #43e97b 0%, #38f9d7 100%)' },
                    { value: 'linear-gradient(to top, #30cfd0 0%, #330867 100%)' },
                    { value: 'linear-gradient(120deg, #89f7fe 0%, #66a6ff 100%)' },
                    { value: 'linear-gradient(to right, #0ba360 0%, #3cba92 100%)' },
                    
                    // Row 3 - ÊöñËâ≤Ê∏êÂèòÁ≥ª
                    { value: 'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)' },
                    { value: 'linear-gradient(135deg, #f6d365 0%, #fda085 100%)' },
                    { value: 'linear-gradient(to right, #fa709a 0%, #fee140 100%)' },
                    { value: 'linear-gradient(to right, #ff758c 0%, #ff7eb3 100%)' },
                    { value: 'linear-gradient(to top, #ff0844 0%, #ffb199 100%)' },
                    { value: 'linear-gradient(120deg, #f093fb 0%, #f5576c 100%)' },
                    { value: 'linear-gradient(to right, #ed6ea0 0%, #ec8c69 100%)' },
                    
                    // Row 4 - Ê∑±Ëâ≤Á≥ª
                    { value: 'linear-gradient(to top, #09203f 0%, #537895 100%)' },
                    { value: '#0f172a' },
                    { value: '#1e293b' },
                    { value: '#475569' },
                    { value: '#000000' },
                    { value: 'linear-gradient(135deg, #2c3e50 0%, #34495e 100%)' },
                    { value: 'linear-gradient(to right, #232526 0%, #414345 100%)' },
                    
                    // Row 5 - ÊµÖËâ≤ÂíåÁ∫ØËâ≤Á≥ª
                    { value: '#ffffff' },
                    { value: '#f8fafc' },
                    { value: '#e2e8f0' },
                    { value: '#94a3b8' },
                    { value: 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)' },
                    { value: 'linear-gradient(to right, #e0eafc 0%, #cfdef3 100%)' },
                    { value: 'transparent' }
                ];

                // Â∫îÁî®‰∏ªÈ¢òÈÖçÁΩÆ - ÂÆåÊï¥Ë¶ÜÁõñÊâÄÊúâÈÖçÁΩÆÈ°π
                const applyTheme = (key) => {
                    const theme = themes.value[key];
                    if (!theme) return;
                    
                    config.value.theme = key;
                    
                    // Â∫îÁî®‰∏ªÈ¢òÁöÑÊâÄÊúâÈÖçÁΩÆÂà∞ config
                    const themeConfig = theme.config;
                    
                    // ÁîªÂ∏ÉÈÖçÁΩÆ
                    if (themeConfig.canvas.ratio) {
                        config.value.ratio = themeConfig.canvas.ratio;
                    }
                    config.value.background = themeConfig.canvas.background;
                    config.value.padding = themeConfig.canvas.padding;
                    config.value.borderRadius = themeConfig.canvas.borderRadius;
                    config.value.bgType = themeConfig.canvas.bgType;
                    if (themeConfig.canvas.canvasScale) {
                        canvasScale.value = themeConfig.canvas.canvasScale;
                    }
                    
                    // Ê†áÈ¢òÂíåÂÜÖÂÆπÈÖçÁΩÆ
                    config.value.fontSize = themeConfig.content.fontSize;
                    config.value.fontFamily = themeConfig.content.fontFamily;
                    config.value.color = themeConfig.content.color;
                    config.value.textAlign = themeConfig.content.textAlign;
                    
                    // ‰ΩúËÄÖ„ÄÅÊó∂Èó¥„ÄÅÈ°µÁ†Å„ÄÅÊ∞¥Âç∞ÁöÑÊòæÁ§∫Áä∂ÊÄÅ
                    config.value.showAuthor = themeConfig.author.show;
                    config.value.showTime = themeConfig.time.show;
                    config.value.showPageNumber = themeConfig.pageNumber.show;
                    config.value.showWatermark = themeConfig.watermark.show;
                    
                    // Êó∂Èó¥ÂíåÈ°µÁ†ÅÊ†ºÂºè
                    config.value.timeFormat = themeConfig.time.format;
                    config.value.pageNumberFormat = themeConfig.pageNumber.format;
                    config.value.watermarkText = themeConfig.watermark.text;
                };
                
                // ÂΩìÂâç‰∏ªÈ¢òÈÖçÁΩÆ - Áî®‰∫éÊéßÂà∂Êéß‰ª∂ÊòæÁ§∫
                const currentThemeConfig = computed(() => {
                    return themes.value[config.value.theme]?.config || (themes.value['modern']?.config || {});
                });

                const cardChunks = computed(() => {
                    const lines = markdownInput.value.split('\n');
                    const chunks = [];
                    let currentChunk = [];
                    let currentLineCount = 0;
                    
                    const currentRatio = config.value.ratio;
                    // Use config values directly instead of theme lookup
                    const maxLines = ratios[currentRatio].maxLines;
                    const fontSize = parseInt(config.value.fontSize) || 18;
                    
                    const adjustedMaxLines = fontSize <= 14 ? maxLines * 1.4 : 
                                           fontSize >= 20 ? maxLines * 0.8 : maxLines;

                    lines.forEach(line => {
                        if (line.trim() === '---') {
                            if (currentChunk.length > 0) {
                                chunks.push(currentChunk.join('\n'));
                                currentChunk = [];
                                currentLineCount = 0;
                            }
                            return;
                        }

                        let lineWeight = 1;
                        if (line.startsWith('# ')) lineWeight = 2;
                        else if (line.startsWith('## ')) lineWeight = 1.5;
                        else if (line.length > 22) lineWeight = Math.ceil(line.length / 22);

                        if (currentLineCount + lineWeight > adjustedMaxLines && currentChunk.length > 0) {
                            chunks.push(currentChunk.join('\n'));
                            currentChunk = [line];
                            currentLineCount = lineWeight;
                        } else {
                            currentChunk.push(line);
                            currentLineCount += lineWeight;
                        }
                    });

                    if (currentChunk.length > 0) chunks.push(currentChunk.join('\n'));
                    return chunks.length > 0 ? chunks : [''];
                });

                const cardStyle = computed(() => {
                    const ratio = ratios[config.value.ratio];
                    const scale = canvasScale.value / 100;
                    return {
                        width: `${ratio.width}px`,
                        height: `${ratio.height}px`,
                        color: config.value.color,
                        borderRadius: `${config.value.borderRadius}px`,
                        transform: `scale(${scale})`,
                        transition: 'all 0.3s ease',
                        flexShrink: 0
                    };
                });

                const contentStyle = computed(() => {
                    const themeContent = currentThemeConfig.value.content;
                    return {
                        fontSize: themeContent.fontSize,
                        fontFamily: themeContent.fontFamily || 'inherit',
                        fontWeight: themeContent.fontWeight || '300',
                        textAlign: themeContent.textAlign || 'left',
                        lineHeight: themeContent.lineHeight,
                        backgroundColor: themeContent.backgroundColor,
                        backdropFilter: themeContent.backdropFilter,
                        padding: themeContent.padding,
                        borderRadius: themeContent.borderRadius,
                        boxShadow: '0 10px 30px rgba(0,0,0,0.1)',
                        border: '1px solid rgba(255,255,255,0.1)'
                    };
                });

                const outerBackground = computed(() => {
                    const canvasConfig = currentThemeConfig.value.canvas || {};
                    if (canvasConfig.backgroundTarget === 'inner') {
                        return canvasConfig.outerBackground || config.value.background;
                    }
                    return config.value.background;
                });

                const innerBackground = computed(() => {
                    const canvasConfig = currentThemeConfig.value.canvas || {};
                    if (canvasConfig.backgroundTarget === 'inner') {
                        return config.value.background;
                    }
                    return canvasConfig.innerBackground || 'transparent';
                });

                const renderMarkdown = (text) => marked.parse(text);

                const downloadSingleCard = async (index) => {
                    const node = document.getElementById(`card-${index}`);
                    const originalScale = canvasScale.value;
                    const originalBorderRadius = config.value.borderRadius;
                    try {
                        // ‰∏¥Êó∂ËÆæÁΩÆÁº©Êîæ‰∏∫100%ÂíåÂúÜËßí‰∏∫0
                        canvasScale.value = 100;
                        config.value.borderRadius = 0;
                        await nextTick();
                        await new Promise(resolve => setTimeout(resolve, 100)); // Á≠âÂæÖÊ∏≤Êüì
                        
                        const dataUrl = await htmlToImage.toPng(node, { 
                            quality: 1, 
                            pixelRatio: 2
                        });
                        const link = document.createElement('a');
                        link.download = `card-${index + 1}.png`;
                        link.href = dataUrl;
                        link.click();
                    } catch (error) {
                        console.error('ÂØºÂá∫Â§±Ë¥•', error);
                    } finally {
                        // ÊÅ¢Â§çÂéüÂßãËÆæÁΩÆ
                        canvasScale.value = originalScale;
                        config.value.borderRadius = originalBorderRadius;
                    }
                };

                const exportAllAsZip = async () => {
                    isExporting.value = true;
                    const originalScale = canvasScale.value;
                    const originalBorderRadius = config.value.borderRadius;
                    const zip = new JSZip();
                    try {
                        // ‰∏¥Êó∂ËÆæÁΩÆÁº©Êîæ‰∏∫100%ÂíåÂúÜËßí‰∏∫0
                        canvasScale.value = 100;
                        config.value.borderRadius = 0;
                        await nextTick();
                        await new Promise(resolve => setTimeout(resolve, 100));
                        
                        for (let i = 0; i < cardChunks.value.length; i++) {
                            const node = document.getElementById(`card-${i}`);
                            
                            const dataUrl = await htmlToImage.toPng(node, { 
                                quality: 1, 
                                pixelRatio: 2
                            });
                            
                            const base64Data = dataUrl.replace(/^data:image\/(png|jpg);base64,/, "");
                            zip.file(`card-${i + 1}.png`, base64Data, { base64: true });
                        }
                        const content = await zip.generateAsync({ type: "blob" });
                        saveAs(content, "linshu_cards.zip");
                    } catch (error) {
                        console.error('ÊâπÈáèÂØºÂá∫Â§±Ë¥•', error);
                    } finally {
                        // ÊÅ¢Â§çÂéüÂßãËÆæÁΩÆ
                        canvasScale.value = originalScale;
                        config.value.borderRadius = originalBorderRadius;
                        isExporting.value = false;
                    }
                };

                // Lucide icons removed from dynamic areas to avoid insertBefore errors; no icon recreation needed
                onMounted(async () => {
                    await loadExternalThemes();
                    if (themes.value[config.value.theme]) {
                        applyTheme(config.value.theme);
                    }
                });
                watch([cardChunks, leftTab], () => {});

                return {
                    leftTab, markdownInput, config, ratios, themes, backgrounds,
                    cardChunks, cardStyle, contentStyle, isExporting, canvasScale, columnCount,
                    currentThemeConfig, outerBackground, innerBackground,
                    renderMarkdown, downloadSingleCard, exportAllAsZip, applyTheme, fonts, alignments,
                    handleAvatarUpload, currentTime, getPageNumber, socialIcons, selectSocialIcon
                };
            }
        }).mount('#app');
    -->
</body>
</html>

